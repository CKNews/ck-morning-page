<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CK Morning Page — Template</title>
<style>
  :root {
    color-scheme: light dark;
    --bg: #0b0c10;
    --fg: #e8e8e8;
    --card: #111318;
    --muted: #9aa3ad;
    --link: #79a6ff;
    --border: #242732;
    --note: #4b5563;
    --alert: #b91c1c;
    --warn: #b45309;
  }
  @media (prefers-color-scheme: light) {
    :root {
      --bg: #f7f7fa;
      --fg: #14151a;
      --card: #ffffff;
      --muted: #4a5568;
      --link: #1a56db;
      --border: #e5e7eb;
      --note: #6b7280;
      --alert: #b91c1c;
      --warn: #b45309;
    }
  }
  html, body { margin:0; padding:0; background: var(--bg); color: var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
  .wrap { max-width: 820px; margin: 0 auto; padding: 24px 16px 56px; }
  header { margin-bottom: 12px; }
  h1 { font-size: 28px; line-height: 1.2; margin: 0 0 6px; }
  .dateline { color: var(--muted); font-size: 14px; margin-bottom: 8px; display:flex; gap:8px; flex-wrap:wrap;}
  .updated { color: var(--muted); font-size: 12px; }
  .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; margin: 16px 0; }
  .card img { width: 100%; height: 220px; object-fit: cover; display: block; }
  .card-content { padding: 14px 16px 8px; }
  h2 { font-size: 20px; margin: 0 0 8px; }
  p { margin: 10px 0; line-height: 1.5; font-size: 15.5px; }
  .caption { color: var(--muted); font-size: 13px; padding: 0 16px 12px; }
  footer { margin-top: 28px; color: var(--muted); font-size: 13px; text-align: center; }
  .section-label { font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.04em; color: var(--muted); padding: 10px 16px 0; }
  .tag { display:inline-block; font-size: 11px; border:1px solid var(--border); padding:2px 6px; border-radius:999px; margin-left:6px; color:var(--muted); }
  .tag.NEW { color:#16a34a; border-color:#16a34a33; }
  .tag.UPDATE { color:#1d4ed8; border-color:#1d4ed833; }
  .tag.NOTE { color:var(--note); border-color:#6b728033; }
  .breakbar { position: sticky; top:0; z-index:100; display:none; padding:10px 12px; margin:0 0 10px; border-bottom:1px solid var(--border); }
  .breakbar.info { background:#0b223933; }
  .breakbar.warning { background:#b453091a; }
  .breakbar.alert { background:#b91c1c1a; }
  .breakbar strong { margin-right:8px; }
  .sr { position:absolute; left:-9999px; }
</style>
</head>
<body>
<div class="wrap">
  <div id="breakbar" class="breakbar" role="status" aria-live="polite"></div>
  <header>
    <h1 id="title">CK Morning Page — Chatham-Kent, Ontario</h1>
    <div class="dateline">
      <span id="date">Loading…</span>
      <span>·</span>
      <span id="tz">America/Toronto</span>
      <span class="updated" id="generated"></span>
    </div>
  </header>

  <main id="content"></main>

  <footer>© <span id="year"></span> CK Morning Page. Information compiled from official public sources.</footer>
</div>

<script>
async function loadData() {
  const res = await fetch('ck-data.json', {cache:'no-store'});
  const data = await res.json();
  render(data);
}
function esc(s){return String(s||'').replace(/[&<>]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));}

function render(data){
  const content = document.getElementById('content');
  document.getElementById('title').textContent = data.meta?.title || 'CK Morning Page — Chatham-Kent, Ontario';
  document.getElementById('date').textContent = new Date(data.meta?.date_local + 'T00:00:00').toLocaleDateString(undefined, {weekday:'long', year:'numeric', month:'long', day:'numeric'});
  document.getElementById('tz').textContent = data.meta?.timezone || 'America/Toronto';
  document.getElementById('generated').textContent = data.meta?.generated_at_iso ? `· updated ${new Date(data.meta.generated_at_iso).toLocaleString()}` : '';
  document.getElementById('year').textContent = new Date().getFullYear();

  // Breaking bar
  const bb = document.getElementById('breakbar');
  const br = data.meta?.breaking || {};
  if (br.active && br.message) {
    bb.style.display = 'block';
    bb.classList.add(br.severity === 'alert' ? 'alert' : br.severity === 'warning' ? 'warning' : 'info');
    bb.innerHTML = `<strong>Alert:</strong>${esc(br.message)}`;
  } else {
    bb.style.display = 'none';
  }

  const labels = {
    weather: 'Weather',
    police_daily: 'CK Police Daily Brief',
    police_special: 'Police — Major Special Releases',
    public_health: 'Public Health',
    council: 'Council / Municipality',
    roads: 'Roads & Construction',
    transit: 'Transit (Ride CK)',
    utilities: 'Utilities / Power (Entegrus)',
    community: 'Community & Events',
    sports: 'Local Sports'
  };

  const order = ['weather','police_daily','police_special','public_health','council','roads','transit','utilities','community','sports'];

  content.innerHTML = '';
  for (const key of order) {
    const section = (data.sections || []).find(s => s.key === key);
    const items = section?.items || [];
    for (const item of items) {
      const tag = item.tag ? `<span class="tag ${esc(item.tag)}">${esc(item.tag)}</span>` : '';
      const img = item.image || {};
      const paras = (item.paragraphs||[]).map(p=>`<p>${esc(p)}</p>`).join('');
      const updated = item.updated_at ? `<span class="updated">Updated ${new Date(item.updated_at).toLocaleString()}</span>` : '';
      content.insertAdjacentHTML('beforeend', `
        <article class="card">
          <img src="${esc(img.src||'')}" alt="${esc(img.alt||'')}" />
          <div class="section-label">${esc(labels[key]||key)}</div>
          <div class="card-content">
            <h2>${esc(item.headline)} ${tag}</h2>
            ${paras}
          </div>
          <div class="caption">${esc(img.caption||'')} ${updated}</div>
        </article>
      `);
    }
  }
}

loadData().catch(e=>{
  document.getElementById('content').innerHTML = '<p>Could not load ck-data.json. Place this template and ck-data.json in the same folder.</p>';
});
</script>
</body>
</html>
